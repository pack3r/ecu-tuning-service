ok<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <title>Historia zada - Serwis Plik贸w</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <header class="top-bar">
      <div class="logo">Serwis Plik贸w</div>
      <nav>
        <a href="/home" class="btn">Panel g贸wny</a>
        <a href="/jobs/new" class="btn">Nowe zadanie</a>
        <a href="/jobs/history" class="btn">Historia zada</a>
        <div class="phone-number"> +48 533 193 112</div>
        <form method="post" action="/logout">
          <button type="submit" class="btn">Wyloguj</button>
        </form>
      </nav>
    </header>

    <main class="container">
      <h1>Historia zada</h1>

      <section class="card">
        <h2>Historia</h2>
        <% if (!jobs || jobs.length === 0) { %>
        <p>Brak zada.</p>
        <% } else { %>
        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Pojazd</th>
              <th>Sterownik ECU</th>
              <th>Plik oryginalny</th>
              <th>Status</th>
              <th>Utworzono</th>
              <th>Szczeg贸y</th>
              <th>Edytuj</th>
              <th>Pobierz</th>
            </tr>
          </thead>
          <tbody>
            <% 
            function translateStatus(status) {
              const statusMap = {
                'pending': 'Oczekujce',
                'completed': 'Zakoczone',
                'processing': 'W trakcie',
                'cancelled': 'Anulowane'
              };
              return statusMap[status] || status;
            }
            %>
            <% jobs.forEach(function(job) { %>
            <tr>
              <td><%= job.id %></td>
              <td>
                <% if (job.vehicle_make && job.vehicle_model && job.vehicle_year) { %>
                <%= job.vehicle_make %> <%= job.vehicle_model %> (<%= job.vehicle_year %>)
                <% } else { %>
                <span style="color: #9ca3af;">-</span>
                <% } %>
              </td>
              <td>
                <% if (job.ecu_controller) { %>
                <%= job.ecu_controller %>
                <% } else { %>
                <span style="color: #9ca3af;">-</span>
                <% } %>
              </td>
              <td><%= job.original_filename %></td>
              <td><%= translateStatus(job.status) %></td>
              <td><%= job.created_at %></td>
              <td><a href="/jobs/<%= job.id %>" class="btn-sm">Szczeg贸y</a></td>
              <td>
                <% if (job.status === 'pending') { %>
                <a href="/jobs/<%= job.id %>/edit" class="btn-sm">Edytuj</a>
                <% } else { %>
                <span style="color: #9ca3af;">-</span>
                <% } %>
              </td>
              <td>
                <% if (job.processed_filename) { %>
                <a href="/jobs/<%= job.id %>/download" class="btn-sm">Pobierz</a>
                <% } else { %>
                <span>-</span>
                <% } %>
              </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
        <% } %>
      </section>
    </main>
  </body>
  </html>
